- [클로저의 의미 및 원리](#클로저의-의미-및-원리)
  - [클로저의 의미](#클로저의-의미)
  - [클로저 예시](#클로저-예시)
    - [콜스택 흐름](#콜스택-흐름)
    - [예시에 대한 가비지 컬렉터 동작 방식](#예시에-대한-가비지-컬렉터-동작-방식)
- [클로저와 메모리 관리](#클로저와-메모리-관리)
  - [메모리 관리 방법](#메모리-관리-방법)
- [클로저 활용 사례](#클로저-활용-사례)
  - [1. 콜백 함수 내부에서 외부 데이터 사용](#1-콜백-함수-내부에서-외부-데이터-사용)
  - [2. 접근 권한 제어(정보 은닉)](#2-접근-권한-제어정보-은닉)
    - [접근권한 제어 방법](#접근권한-제어-방법)
  - [3. 부분 적용 함수](#3-부분-적용-함수)
  - [4. 커링 함수](#4-커링-함수)
- [필요한 추가 학습](#필요한-추가-학습)

## 클로저의 의미 및 원리

### 클로저의 의미

- MDN 정의 : 클로저는 함수와 함수가 선언될 당시의 `Lexical Environment`의 상호관계에 따른 현상
  - 선언될 당시 `Lexical Environment`는 실행 컨택스트의 구성 요소 중 `outerEnvironmentReference`를 의미
  - 컨텍스트 A에서 선언한 내부함수 B의 실행 컨택스트가 활성화된 시점에 B의 `outerEnvironmentReference`가 참조하는 A의 `LexicalEnvironment`에 접근 가능
  - 내부함수에서 외부 변수를 참조하는 경우에 한에서 combination, 즉 선언될 당시의 `LexcialEnvironment`와의 상호관계가 의미가 있다.
    => **"어떤 함수에서 선언한 변수를 참조하는 내부함수에서 발생하는 현상"**

### 클로저 예시

```js
var outer = function () {
  var a = 1;
  var inner = function () {
    return ++a;
  };
  return inner;
};

var outer2 = outer();
console.log(outer2()); // 2
console.log(outer2()); // 3
```

#### 콜스택 흐름

- inner 함수의 실행결과가 아닌 inner 함수 자체를 반환
- outer 함수의 실행 컨텍스트가 종료될 때 outer2는 outer의 실행 결과인 inner 함수를 참조
- 이후 outer2를 호출하면 inner가 실행
- inner 함수의 실행 컨택스트의 `outerEnvironmentReference`가 outer함수의 `LexicalEnvironment`를 참조
- 스코프 체인에 따라 변수 `a`에 접근하여 값을 증가시킨 후 이를 반환함으로써, inner 함수의 실행 컨택스트가 종료

#### 예시에 대한 가비지 컬렉터 동작 방식

- 가비지 컬렉터는 어떤 값을 참조하는 변수가 하나라도 있으면, 그 값은 수집대상에 포함시키지 않는다.
- outer함수의 실행종료 시점에 반환된 inner함수는 outer2를 실행함으로써 호출될 가능성이 생기게 되고<br>, 이는 inner 함수의 실행컨텍스트가 활성화 되면 outer 함수의 `LexicalEnvironment`가 필요할 것이므로, 가비지 컬렉터의 수집대상에서 제외되어, inner 함수가 `a`에 접근할 수 있다.

=> `어떤 함수에서 선언한 변수를 참조하는 내부함수에서 발생하는 현상`이란 외부 함수의 `LexicalEnvironment`가 가비지 컬렉팅 되지 않는 현상<br>
=> **클로저란 `어떤 함수 A에서 선언한 변수 a를 참조하는 내부함수 B를 외부로 전달할 경우, A의 실행컨텍스트가 종료된 이후에도 변수 a가 살지지 않는 현상`이다.**

## 클로저와 메모리 관리

- 클로저는 메모리를 계속 차지함으로 더는 사용하지 않게 된 클로저에 대해 메모리를 차지하지 않도록 관리할 필요가 있다.

### 메모리 관리 방법

- 참조 카운트를 0으로 만들어주기 위해 식별자에 참조형이 아닌 기본형 데이터(null 이나 undefined)를 할당한다.

## 클로저 활용 사례

### 1. 콜백 함수 내부에서 외부 데이터 사용

- 예시 1. 콜백함수를 내부에서 선언해 외부변수를 직접 참조하는 방식
- 예시 2. `bind`메서드로 값을 넘겨주는 방식 => 인자로 넘어오는 순사 및 `this`가 달라질 수 있다.
- 예시 3. 예시 2에서 발생한 문제를 해결하기 위하 고차함수를 활용하는 방식
  - 고차함수 : 함수를 인자로 받거나 함수를 리턴하는 함수

### 2. 접근 권한 제어(정보 은닉)

- 정보 은닉 : 모듈의 내부 로직에 대해 외부로의 노출을 최소화하는 것
  - 모듈간의 결합도를 낮추고 유연성을 높이는 효과

#### 접근권한 제어 방법

1. 함수에서 지역변수 및 내부함수 생성
2. 외부에 접근권한을 주고자 하는 대상들로 구성된 참조형 데이터를 return
   - return한 변수들은 공개 멤버가 되고, 그렇지 않은 변수들은 비공게 멤버가 된다.

### 3. 부분 적용 함수

- 부분 적용 함수(Partially applied Function) : n개의 인자를 받는 함수에 미리 m개이 인자만 넘겨 기억한 후,<br> 나중에 (n-m)개의 인자를 넘기면 함수의 실행결과를 얻을 수 있게 하는 함수

### 4. 커링 함수

- 커링 함수 : 여러 개의 인자를 받는 함수를 하나의 인자만 받는 함수로 나눠, 순차적으로 호출될 수 있게 체인 형태로 구성하는 함수
- 화살표 함수를 통해 가독성이 좋게 커링함수를 구현할 수 있다.

  ```js
  var curr = (func) => (a) => (b) => (c) => (d) => func(a, b, c, d);
  ```

- 각 단계에서 받은 인자들을 마지막 단계에서 참조하므로, 마지막 호출로 인한 실행컨텍스트 종료 후, 비로소 한꺼번에 GC 수거 대상이 된다.
- 필요한 정보를 미리 받은 후, 원하는 시점까지 지연시켰다가 실행하는 `지연실행 `을 구현하는데 유용하다.

## 필요한 추가 학습

- 결합도, 응집도
- 디바운스
